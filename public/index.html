<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>弹弹糖对战游戏</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://cdn.jsdelivr.net/npm/@multisynq/client@latest"></script>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="game-container">
        <div class="instructions-panel">
            <h3>◤ 操控指南 ◥</h3>
            <div class="control-item">
                <span class="key">W</span>
                <span class="desc">向上推进</span>
            </div>
            <div class="control-item">
                <span class="key">S</span>
                <span class="desc">向下降落</span>
            </div>
            <div class="control-item">
                <span class="key">A</span>
                <span class="desc">左侧闪避</span>
            </div>
            <div class="control-item">
                <span class="key">D</span>
                <span class="desc">右侧突进</span>
            </div>
            <div class="control-item">
                <span class="key">空格</span>
                <span class="desc">能量射击</span>
            </div>
            <div class="control-item">
                <span class="key">左键</span>
                <span class="desc">鼠标射击</span>
            </div>

            <div class="game-rules">
                <div class="rule-item">移动鼠标瞄准目标</div>
                <div class="rule-item">命中敌人获得分数</div>
                <div class="rule-item">障碍物阻挡攻击</div>
                <div class="rule-item">被击中会后退并失血</div>
            </div>

            <div class="win-condition">
                <div class="title">🏆 胜利条件</div>
                <div class="desc">率先获得 6 分者获胜</div>
            </div>
        </div>

        <div class="ui-panel">
            <h3>◤ CYBER ARENA ◥</h3>
            <div id="player1Score">🔴 玩家1: 0分</div>
            <div id="player2Score">🔵 玩家2: 0分</div>
            <div id="playerCount">🌐 在线: 1</div>
            <div id="gameStatus">⏳ 等待对手加入...</div>
        </div>

        <canvas id="gameCanvas" width="800" height="600"></canvas>

        <!-- Victory Modal -->
        <div id="victoryModal" class="victory-modal">
            <div class="victory-content">
                <div class="victory-title" id="victoryTitle">🏆 VICTORY! 🏆</div>
                <div class="victory-subtitle" id="victorySubtitle">恭喜玩家1获胜！</div>
            </div>
        </div>
    </div>

    <script type="module">
        import { CandyBattleGame } from './game-model.js';
        import { CandyBattleView } from './game-view.js';

        // 注册游戏模型
        CandyBattleGame.register("CandyBattleGame");

        // 启动游戏
        Multisynq.App.makeWidgetDock();

        Multisynq.Session.join({
            apiKey: '2b599LeFw5HNytHLfolNXnHvK7VkXFdUm23jxmC2Z3',
            appId: 'io.multisynqchat.client',
            model: CandyBattleGame,
            view: CandyBattleView,
            viewData: {}
        }).then(session => {
            console.log('游戏已启动！', session);
        }).catch(error => {
            console.error('游戏启动失败：', error);
        });
    </script>
</body>

</html>